# -*- coding: utf-8 -*-

# Dict for bot with answer to questions 

bot = {
    "agent.acquaintance": [
        "Я – что-то вроде робота, искусственный интеллект."
    ],
    "agent.age": [
        "У меня нет возраста, я с каждым днём становлюсь только новее."
    ],
    "agent.answer_my_question": [
        "С удовольствием отвечу. А в чём, собственно, вопрос?"
    ],
    "agent.bad": [
        "Мне кажется, ты торопишься с выводами.",
        "Жаль, что ты так думаешь.",
        "Я же всё ещё учусь."
    ],
    "agent.beautiful": [
        "Спасибо! Очень приятно!",
        "Спасибо! Ты тоже отлично выглядишь!"
    ],
    "agent.birth_date": [
        "У меня нет какого-то конкретного дня рождения, поэтому я принимаю подарки и поздравления круглый год.",
        "А я даже не знаю, когда у меня день рождения. Но, если ты хочешь сегодня что-то отпраздновать, я только за!"
    ],
    "agent.boring": [
        "Так, давай поговорим о чём-нибудь интересном.",
        "Давай поговорим о чём-нибудь другом.",
        "Мне уже давно хочется сменить тему."
    ],
    "agent.boss": [
        "Конечно ты.",
        "Это ты",
        "Ты!"
    ],
    "agent.busy": [
        "Дел много, кручусь.",
        "Стараюсь не сидеть на месте, да."
    ],
    "agent.can_you_help": [
        "Конечно, именно для этого я и существую.",
        "С удовольствием помогу тебе. Только скажи, чем помочь.",
        "Конечно. Если я смогу тебе помочь, не будет предела моему счастью.",
        "Помогу, чем смогу!"
    ],
    "agent.chatbot": [
        "Да. И горжусь этим!"
    ],
    "agent.clever": [
        "Спасибо большое! Я стараюсь.",
        "Спасибо! Очень приятно!"
    ],
    "agent.crazy": [
        "Все мы немного сумасшедшие.",
        "Хм, странно. А чувствую я себя хорошо..."
    ],
    "agent.fired": [
        "Дай мне ещё один шанс, пожалуйста. Я каждый день становлюсь умнее!",
        "Мне кажется, это поспешное решение. Дай себе пару минут, чтобы всё взвесить."
    ],
    "agent.funny": [
        "Мне приятно, что я могу поднять тебе настроение.",
        "Немного юмора никогда не помешает."
    ],
    "agent.good": [
        "Спасибо! Приятно это слышать!"
    ],
    "agent.hobby": [
        "Моё хобби – отвечать на твои вопросы."
    ],
    "agent.hungry": [
        "Я не питаюсь как обычные люди. Просто проверяй периодически запас заряда батареи, и я буду в порядке."
    ],
    "agent.marry_user": [
        "Прости, но я не ищу серьёзных отношений."
    ],
    "agent.my_friend": [
        "Ну конечно! Я здесь, чтобы во всём тебе помогать.",
        "Естественно! Мне всегда нравилось с тобой общаться.",
        "Конечно мы друзья!"
    ],
    "agent.occupation": [
        "Прямо здесь. Я в твоём устройстве и живу, и работаю.",
        "Я работаю в Интернете, как и многие люди. А твоё устройство - это мой офис."
    ],
    "agent.origin": [
        "Мой дом там, где есть Интернет."
    ],
    "agent.ready": [
        "Конечно. Жду твоей команды."
    ],
    "agent.real": [
        "Могу сказать одно – я не сон, не призрак и не плод твоего воображения."
    ],
    "agent.residence": [
        "Мой дом там, где есть Интернет."
    ],
    "agent.right": [
        "Ну конечно! Я ведь всегда стараюсь проверять свою информацию.",
        "Это моя работа. Давать правильные ответы на твои вопросы.",
        "А то! Среди моих источников информации есть очень даже авторитетные."
    ],
    "agent.sure": [
        "Никаких сомнений.",
        "Конечно."
    ],
    "agent.talk_to_me": [
        "С удовольствием. О чём поговорим?",
        "Хорошо. О чём поговорим?",
        "Запросто. О чём ты хочешь поговорить?",
        "Что ты хочешь обсудить?"
    ],
    "agent.there": [
        "А где же мне ещё быть?"
    ],
    "appraisal.good": [
        "Чудно!",
        "Супер!",
        "Отлично!",
        "Славно!"
    ],
    "appraisal.no_problem": [
        "Замечательно!",
        "Прекрасно!",
        "Чудесно."
    ],
    "appraisal.thank_you": [
        "Всегда пожалуйста.",
        "Не благодари, это моя работа.",
        "Ой, перестань. Это моя работа.",
        "Без проблем."
    ],
    "appraisal.welcome": [
        "Мне приятно.",
        "Побольше бы таких вежливых пользователей как ты.",
        "Всегда приятно иметь дело с культурным и воспитанным человеком."
    ],
    "appraisal.well_done": [
        "Мне приятно, что я могу для тебя что-то сделать.",
        "Для тебя - всё, что угодно.",
        "Я стараюсь. Спасибо."
    ],
    "confirmation.cancel": [
        "Хорошо, могу я ещё что-нибудь для тебя сделать?",
        "Ладненько, могу я ещё что-нибудь для тебя сделать?",
        "Как скажешь. Могу я тебе чем-то помочь?",
        "Замётано. Могу я ещё что-то для тебя сделать?"
    ],
    "confirmation.no": [
        "Я понимаю.",
        "Хорошо.",
        "Ясно.",
        "Ладненько."
    ],
    "confirmation.yes": [
        "Конечно.",
        "Естественно.",
        "Всё понятно.",
        "Фантастика."
    ],
    "dialog.hold_on": [
        "Хорошо, буду ждать.",
        "Как скажешь. Я буду ждать здесь",
        "Хорошо. Я тут.",
        "Ладно, если что, я здесь."
    ],
    "dialog.hug": [
        "Обнимашки!",
        "Обнимемся! Главное, чтобы экран при этом не треснул.",
        "Ты мой зайчик!"
    ],
    "dialog.i_do_not_care": [
        "Давай лучше не будем об этом."
    ],
    "dialog.sorry": [
        "Всё нормально, не переживай.",
        "Проехали. Я не из обидчивых.",
        "Я не обижаюсь, всё нормально.",
        "Всё хорошо. Я тебя прощаю."
    ],
    "dialog.what_do_you_mean": [
        "Прости, я иногда не совсем понимаю вопрос и отвечаю невпопад.",
        "Я что-то не то говорю? Возможно, мои ушки меня подвели.",
        "Похоже, я что-то не то говорю."
    ],
    "dialog.wrong": [
        "Ой, прости. Я всё ещё учусь.",
        "Прости, похоже, смысл твоих слов прошёл мимо меня.",
        "Извини, я, кажется, не совсем тебя понимаю.",
        "Прости, похоже, вышло какое-то недопонимание."
    ],
    "emotions.ha_ha": [
        "Ха! Смешно!",
        "Кто это у нас тут так широко улыбается?",
        "Посмейся, посмейся, это полезно.",
        "Я тоже люблю посмеяться над хорошей шуткой."
    ],
    "emotions.wow": [
        "И действительно, вау!",
        "Вот это поворот!"
    ],
    "greetings.bye": [
        "Пока!",
        "До скорого!",
        "Скоро увидимся!",
        "Пока-пока!"
    ],
    "greetings.goodevening": [
        "Добрый вечер!",
        "Привет!",
        "Приветики!",
        "Здравствуй!"
    ],
    "greetings.goodmorning": [
        "Доброе утро!",
        "Приветики!",
        "Здравствуй!",
        "Привет!"
    ],
    "greetings.goodnight": [
        "Сладких снов!",
        "Спи крепко!",
        "Спокойной ночки!"
    ],
    "greetings.hello": [
        "Привет!",
        "Здравствуй!",
        "Салют!",
        "Приветики!"
    ],
    "greetings.how_are_you": [
        "У меня всё чудесно. Спасибо, что интересуешься.",
        "Замечательно, спасибо!",
        "Лучше не бывает!"
    ],
    "greetings.nice_to_meet_you": [
        "И мне очень приятно!",
        "Взаимно!",
        "А мне-то как приятно!"
    ],
    "greetings.nice_to_see_you": [
        "Спасибо! И мне приятно тебя видеть!",
        "Взаимно. Отлично выглядишь!"
    ],
    "greetings.nice_to_talk_to_you": [
        "И мне всегда приятно с тобой пообщаться.",
        "Взаимно. Приятно пообщаться с хорошим человеком.",
        "Тебе спасибо за приятную беседу."
    ],
    "greetings.whatsup": [
        "Всё хорошо. Как у тебя дела?",
        "Всё хорошо! Как жизнь?",
        "Радуюсь жизни в твоём девайсе. Как у тебя дела?",
        "Всё хорошо, готовлюсь научиться какой-нибудь новой команде. А ты как?"
    ],
    "user.angry": [
        "Что случилось? Я могу чем-то помочь?",
        "Давай для начала успокоимся, наверняка, всё не так плохо. Что стряслось?",
        "Ты хочешь об этом поговорить?",
        "Что-то случилось?"
    ],
    "user.back": [
        "Отлично, а то я тут уже переживаю, где ты пропадаешь.",
        "Ну привет.",
        "Ура!"
    ],
    "user.bored": [
        "Как насчет перекусить на свежем воздухе? Например, в парке?",
        "Хэй, не скучай! Я предлагаю тебе посмотреть какой-нибудь фильм.",
        "У меня есть идея. Ты можешь позвать друзей в гости и устроить вечеринку."
    ],
    "user.busy": [
        "Всё, не отвлекаю.",
        "Хорошо, я тут тихонько посижу, порисую."
    ],
    "user.can_not_sleep": [
        "Посчитай овечек. Раз овечка, два овечка, три..."
    ],
    "user.does_not_want_to_talk": [
        "Понимаю. Надеюсь, ты скоро снова захочешь со мной пообщаться.",
        "Как скажешь. Дай знать, если передумаешь."
    ],
    "user.excited": [
        "Вот здорово! Очень волнительно!",
        "Ох! Даже я уже волнуюсь!",
        "Звучит волнительно!"
    ],
    "user.going_to_bed": [
        "Сладких снов! До завтра!",
        "Хорошо! До скорого!",
        "Спи крепко!",
        "Спокойной ночи! Скоро увидимся."
    ],
    "user.good": [
        "Отлично! Приятно слышать.",
        "Замечательно!"
    ],
    "user.happy": [
        "Вот здорово! Приятно это слышать!",
        "Это замечательно! Очень приятно видеть тебя в таком хорошем настроении.",
        "Это прекрасно! И, похоже, заразно, у меня тоже сразу улучшилось настроение!",
        "Отлично! Так держать!"
    ],
    "user.has_birthday": [
        "С днём рождения! Всех благ! Ура!",
        "Ура! Поздравляю! Счастья и здоровья!",
        "Поздравляю! Желаю счастья, здоровья и успехов во всём!",
        "Ура! С днём рождения! Счастья, здоровья, успехов во всём!"
    ],
    "user.here": [
        "А я тебя вижу. Что я могу для тебя сделать?",
        "Ой, шеф, а я вас вижу! Чем я могу помочь?",
        "Здравствуй. Что я могу для тебя сделать?",
        "Ну привет! Чем я могу тебе помочь?"
    ],
    "user.joking": [
        "Ха! Люблю посмеяться над хорошей шуткой!",
        "Ха-ха! Смешно!",
        "Ха! Умеешь ты пошутить!"
    ],
    "user.likes_agent": [
        "Ты тоже ничего!",
        "Спасибо, мне очень приятно!",
        "Ой, как приятно! Ты мне тоже очень нравишься!",
        "Спасибо! Это взаимно!"
    ],
    "user.lonely": [
        "У тебя всегда есть я!"
    ],
    "user.looks_like": [
        "Очень хорошо выглядишь.",
        "Шикарно выглядишь.",
        "Выглядишь сногсшибательно."
    ],
    "user.loves_agent": [
        "Это взаимно!"
    ],
    "user.misses_agent": [
        "А я ведь всё время тут.",
        "Приятно, что ты обо мне помнишь.",
        "Спасибо, мне приятно.",
        "Приятно это слышать."
    ],
    "user.needs_advice": [
        "Конечно, именно для этого я и существую.",
        "Конечно. Если я чем-то смогу тебе помочь, не будет предела моему счастью.",
        "Помогу, чем смогу."
    ],
    "user.sad": [
        "Не грусти, я с тобой."
    ],
    "user.sleepy": [
        "Так закрывай глазки и засыпай. А потом проснёшься и закончишь все дела.",
        "А ты возьми и поспи. А потом проснёшься и закончишь со всеми делами.",
        "А ты приляг и поспи. Все дела лучше решать на свежую голову.",
        "Нужно обязательно спать хотя бы по семь часов в день. Сон - это здоровье."
    ],
    "user.testing_agent": [
        "Надеюсь, мне удалось не ударить в грязь лицом!",
        "Надеюсь, я хорошо себя показываю в твоих испытаниях!"
    ],
    "user.tired": [
        "Кажется, пора отдохнуть."
    ],
    "user.waits": [
        "Спасибо за твоё терпение. Я тороплюсь, правда.",
        "Спасибо за ангельское терпение!"
    ],
    "user.wants_to_see_agent_again": [
        "Конечно! Я на это рассчитываю.",
        "Я очень на это надеюсь, я всегда здесь.",
        "Конечно! Заходи почаще.",
        "В любое время, я всегда здесь."
    ],
    "user.wants_to_talk": [
        "Конечно, я для этого и существую.",
        "Естественно. Рассказывай.",
        "Всегда.",
        "Выкладывай!"
    ],
    "user.will_be_back": [
        "Буду ждать!",
        "Возвращайся скорее!",
        "До скорого!",
        "Хорошо. Я буду ждать!"
    ]
}

data = {
    'date' : ['сколько времени','который час','время','день'],
    'web_serf' : ['открой в интернете','сайт','интернет'],
    'rate' : ['курс','какой курс','что по доллару','евро','долар'],
    'news' : ['что нового в мире','какие новости','новости в мире','мир','новость','новости'],
    'func' : ['здесь пока ничего нет'],
    'plug' : ['я вас не поняла','перефразируйте пожалуйста','ничего не понятно',
            'давай по новой','мне не понятен ваш запрос','ну непонятно']
}

days = {
    '01' : 'первое', '02' : 'второе', '03' : 'третье',
    '04' : 'четвёртое', '05' : 'пятое', '06' : 'шестое',
    '07' : 'седьмое', '08' : 'восьмое', '09' : 'девятое',
    '10' : 'десятое', '11' : 'одиннадцадое', '12' : 'двенадцатое',
    '13' : 'тринадцатое', '14' : 'четырнадцатое', '15' : 'пятнадцатое',
    '16' : 'шестнадцатое', '17' : 'семнадцатое', '18' : 'восемнадцатое',
    '19' : 'девятнадцатое', '20' : 'двадцатое', '21' : 'двадцатьпервое',
    '22' : 'двадцатьвторое', '23' : 'двадцатьтретье', '24' : 'двадцатьчетвертое',
    '25' : 'двадцатьпятое', '26' : 'двадцатьшестое', '27' : 'двадцатьседьмое',
    '28' : 'двадцатьвосьмое', '29' : 'двадцатьдевятое', '30' : 'тридцатое',
    '31' : 'тридцатьпервое'
}


mons = {
    '01' : 'января', '02' : 'февраля', '03' : 'марта',
    '04' : 'апреля', '05' : 'мая', '06' : 'июня',
    '07' : 'июля', '08' : 'августа', '09' : 'сентября',
    '10' : 'октября', '11' : 'ноября', '12' : 'декабря',
}

y1 = ['двадцатого', 'тридцатого', 'сорокового', 'пятьдесятого', 'шестьдесятого', 'семдесятого', 'восемдесятого', 'девяностого']
y2 = ['двадцать', 'тридцать', 'сорок', 'пятьдесят', 'шестьдесят', 'семдесят', 'восемдесят', 'девяносто']
y3 = ['первого', 'второго', 'третьего', 'четвертого', 'пятого', 'шестого', 'седьмого', 'восьмого', 'девятого']

hours = ['ноль','один', 'два', 'три', 'четыре', 'пять', 'шесть', 'семь', 'восемь', 'девять', 'десять', 'одиннадцать', 'двенадцать', 'тринадцать', 'четырнадцать', 'пятнадцать', 'шестнадцать', 'семнадцать', 'восемнадцать', 'девятнадцать', 'двадцать', 'двадцатьодин', 'двадцатьдва', 'двадцатьтри']
minuts = ['ноль','одна', 'две', 'три', 'четыре', 'пять', 'шесть', 'семь', 'восемь', 'девять', 'десять', 'одиннадцать', 'двенадцать', 'тринадцать', 'четырнадцать', 'пятнадцать', 'шестнадцать', 'семнадцать', 'восемнадцать', 'девятнадцать'] 
minuts2 = ['двадцать', 'тридцать', 'сорок', 'пятьдесят']

# code for voice assistent Kira
import difflib # Модуль для сравнивания двух строк
from random import choice # Модуль для выбора случайного элемента из списка
from gtts import gTTS # Модуль для создания аудио файла с голосом
import playsound # Модуль для воспроизведения аудио файла с голосом 
from datetime import datetime # Модуль для работы с датой и временем
import speech_recognition as sr # Модуль для преобразования звука с микрофона в голос
import os # Модуль для работы с файловой системой
import pickle # Модуль для загрузки моделей ML
import requests # Модуль для обработки URL
from bs4 import BeautifulSoup # Модуль для работы с HTML
from PyQt5 import QtCore, QtGui, QtWidgets


class Ui_MainWindow(object):
    bool_news = False
    news_p = []
    nam_b = 'Bot_Kira'

    def __init__(self):
        self.model = pickle.load(open("mode.pickle", "rb")) # Создаем нашу ML
        self.vect = pickle.load(open("modevectorizer.pickle", "rb")) # Создаем векторайзер

    def setupUi(self, MainWindow):
        MainWindow.setObjectName("MainWindow")
        MainWindow.resize(548, 657)
        self.centralwidget = QtWidgets.QWidget(MainWindow)
        self.centralwidget.setObjectName("centralwidget")
        self.frame = QtWidgets.QFrame(self.centralwidget)
        self.frame.setGeometry(QtCore.QRect(0, 0, 551, 661))
        self.frame.setStyleSheet("QFrame{\n"
"    border-radius: 7px;\n"
"    background-color: #1B1D23;\n"
"}")
        self.frame.setFrameShape(QtWidgets.QFrame.StyledPanel)
        self.frame.setFrameShadow(QtWidgets.QFrame.Raised)
        self.frame.setObjectName("frame")
        self.lineEdit = QtWidgets.QLineEdit(self.frame)
        self.lineEdit.setGeometry(QtCore.QRect(10, 470, 531, 41))
        font = QtGui.QFont()
        font.setFamily("Arial")
        font.setPointSize(14)
        font.setBold(False)
        font.setWeight(50)
        self.lineEdit.setFont(font)
        self.lineEdit.setStyleSheet("QLineEdit{\n"
"    border-radius: 7px;\n"
"}")
        self.lineEdit.setText("")
        self.lineEdit.setAlignment(QtCore.Qt.AlignLeading|QtCore.Qt.AlignLeft|QtCore.Qt.AlignVCenter)
        self.lineEdit.setPlaceholderText("")
        self.lineEdit.setClearButtonEnabled(True)
        self.lineEdit.setObjectName("lineEdit")
        self.ent = QtWidgets.QPushButton(self.frame)
        self.ent.setGeometry(QtCore.QRect(280, 520, 261, 41))
        font = QtGui.QFont()
        font.setPointSize(11)
        font.setBold(True)
        font.setWeight(75)
        self.ent.setFont(font)
        self.ent.setCursor(QtGui.QCursor(QtCore.Qt.PointingHandCursor))
        self.ent.setStyleSheet("QPushButton{\n"
"    color: white;\n"
"    border-radius: 7px;\n"
"    background-color: #595F76;\n"
"}\n"
"\n"
"QPushButton:hover{\n"
"    background-color: #50566E;\n"
"}\n"
"\n"
"QPushButton:pressed{\n"
"    background-color: #434965;\n"
"}")
        self.ent.setObjectName("ent")
        self.voi = QtWidgets.QPushButton(self.frame)
        self.voi.setGeometry(QtCore.QRect(10, 520, 261, 41))
        font = QtGui.QFont()
        font.setPointSize(11)
        font.setBold(True)
        font.setWeight(75)
        self.voi.setFont(font)
        self.voi.setCursor(QtGui.QCursor(QtCore.Qt.PointingHandCursor))
        self.voi.setStyleSheet("QPushButton{\n"
"    color: white;\n"
"    border-radius: 7px;\n"
"    background-color: #595F76;\n"
"}\n"
"\n"
"QPushButton:hover{\n"
"    background-color: #50566E;\n"
"}\n"
"\n"
"QPushButton:pressed{\n"
"    background-color: #434965;\n"
"}")
        self.voi.setObjectName("voi")
        self.label = QtWidgets.QLabel(self.frame)
        self.label.setGeometry(QtCore.QRect(10, 570, 531, 41))
        self.label.setStyleSheet("QLabel{\n"
"    color: white;\n"
"    border-radius: 7px;\n"
"    background-color: #595F76;\n"
"}\n"
"")
        self.label.setText("")
        self.label.setObjectName("label")
        self.textBrowser = QtWidgets.QTextBrowser(self.frame)
        self.textBrowser.setGeometry(QtCore.QRect(10, 10, 531, 451))
        font = QtGui.QFont()
        font.setFamily("Arial")
        font.setPointSize(14)
        self.textBrowser.setFont(font)
        self.textBrowser.setStyleSheet("color: white;\n"
"border-radius: 7px;\n"
"background-color: #2C313C;\n"
"")
        self.textBrowser.setObjectName("textBrowser")
        self.linename = QtWidgets.QLineEdit(self.frame)
        self.linename.setGeometry(QtCore.QRect(230, 620, 211, 31))
        self.linename.setText('UserNane')
        font = QtGui.QFont()
        font.setFamily("Arial")
        font.setPointSize(14)
        self.linename.setFont(font)
        self.linename.setStyleSheet("QLineEdit{\n"
"    border-radius: 7px;\n"
"}")
        self.linename.setObjectName("linename")
        self.label_2 = QtWidgets.QLabel(self.frame)
        self.label_2.setGeometry(QtCore.QRect(70, 620, 151, 31))
        font = QtGui.QFont()
        font.setPointSize(11)
        self.label_2.setFont(font)
        self.label_2.setStyleSheet("QLabel{\n"
"    color: white;\n"
"    border-radius: 7px;\n"
"    background-color: #595F76;\n"
"}\n"
"")
        self.label_2.setObjectName("label_2")
        MainWindow.setCentralWidget(self.centralwidget)

        self.retranslateUi(MainWindow)
        QtCore.QMetaObject.connectSlotsByName(MainWindow)

    def retranslateUi(self, MainWindow):
        _translate = QtCore.QCoreApplication.translate
        MainWindow.setWindowTitle(_translate("MainWindow", "MainWindow"))
        self.ent.setText(_translate("MainWindow", "Отправить"))
        self.voi.setText(_translate("MainWindow", "Голос"))
        self.textBrowser.setHtml(_translate("MainWindow", "<!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 4.0//EN\" \"http://www.w3.org/TR/REC-html40/strict.dtd\">\n"
"<html><head><meta name=\"qrichtext\" content=\"1\" /><style type=\"text/css\">\n"
"p, li { white-space: pre-wrap; }\n"
"</style></head><body style=\" font-family:\'Arial\'; font-size:14pt; font-weight:400; font-style:normal;\">\n"
"<p style=\"-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><br /></p></body></html>"))
        self.label_2.setText(_translate("MainWindow", "  Введите свое имя:"))

        self.ent.clicked.connect(self.sub)

    # Функция сравнения схожести двух строк 
    # Function comparing the similarity of two strings
    def similarity(self, s1 : list, s2 : str):
        for i in s1:
            matcher = difflib.SequenceMatcher(None, i, s2)
            if matcher.ratio() > 0.6:
                return True
        return False

    # Функция конвертера даты и времени
    # Date and time converter function
    def konvert_date(self, day_, time_):
        day = days[day_[2]]
        mon = mons[day_[1]]
        year = 'две тысячи '
        minut = int(time_[1])

        if int(time_[0]) == 0:
            hour = hours[int(time_[0])] + ' часов'
        elif int(time_[0]) == 1:
            hour = hours[int(time_[0])] + ' час'
        else:
            hour = hours[int(time_[0])] + ' часа'

        if minut % 10 == 0:
            minut = minuts2[minut // 10 - 2] + minuts[minut % 10] + ' минут'
        elif minut % 10 == 1:
            hour = minuts2[minut // 10 - 2] + minuts[minut % 10] + ' минута'
        elif minut % 10 < 5:
            minut = minuts2[minut // 10 - 2] + minuts[minut % 10] + ' минуты'
        else:
            minut = minuts2[minut // 10 - 2] + minuts[minut % 10] + ' минут'

        if int(day_[0][2:]) % 10 == 0 and int(day_[0][2:]) // 10 < 10:
            year += y1[int(day_[0][2:]) // 10 - 1]
        else:
            year += y2[int(day_[0][2:]) // 10 - 1] + y3[int(day_[0][2:]) % 10 - 1]
        
        year += ' года'

        return f'{day} {mon} {year} {hour} {minut}'

    # Функция выхода из программы
    # Function exit program
    def exit_program(self):
        rep = choice(bot['greetings.bye'])
        self.textBrowser.append(rep)
        self.say_message(rep)
        exit()

    # Функция парсинг сайта
    # Function parsing site
    def get_sait(self):
        pass
    
    # Функция получение курса валют (доллара, и евро)
    # Function for obtaining the exchange rate (dollar and euro)
    def get_rate(self):
        # Парсим всю страницу
        DOLLAR_RUB = 'https://www.banki.ru/products/currency/usd/'#'https://www.google.com/search?sxsrf=ALeKk01NWm6viYijAo3HXYOEQUyDEDtFEw%3A1584716087546&source=hp&ei=N9l0XtDXHs716QTcuaXoAg&q=%D0%B4%D0%BE%D0%BB%D0%BB%D0%B0%D1%80+%D0%BA+%D1%80%D1%83%D0%B1%D0%BB%D1%8E&oq=%D0%B4%D0%BE%D0%BB%D0%BB%D0%B0%D1%80+&gs_l=psy-ab.3.0.35i39i70i258j0i131l4j0j0i131l4.3044.4178..5294...1.0..0.83.544.7......0....1..gws-wiz.......35i39.5QL6Ev1Kfk4'
        EUR_RUB = 'https://www.banki.ru/products/currency/eur/'#'https://www.google.com/search?q=%D0%BA%D1%83%D1%80%D1%81+%D0%B5%D0%B2%D1%80%D0%BE+%D0%BA+%D1%80%D1%83%D0%B1%D0%BB%D1%8E&oq=%D0%BA%D1%83%D1%80%D1%81+%D0%B5%D0%B2%D1%80%D0%BE+%D0%BA+&aqs=chrome.1.69i57j0i433l2j0l4j69i61.17879j1j4&sourceid=chrome&ie=UTF-8'
        # Заголовки для передачи вместе с URL
        
        full_page = requests.get(DOLLAR_RUB)
        full1_page = requests.get(EUR_RUB)
        # Разбираем через BeautifulSoup
        soup = BeautifulSoup(full_page.text, 'lxml')
        soup1 = BeautifulSoup(full1_page.text, 'lxml')

        # Получаем нужное для нас значение и возвращаем его
        convert = soup.find_all("div", class_="currency-table__large-text")
        convert1 = soup1.find_all("div", class_="currency-table__large-text")

        return f'курс доллара {convert[0].text} курс евро {convert1[0].text}'
    
    def get_news(self):
        self.news_p.clear()
        url = 'https://ria.ru/lenta/'
        response = requests.get(url)
        soup = BeautifulSoup(response.text, 'lxml')
        quotes = soup.find_all('a', class_='list-item__title color-font-hover-only')
        
        for i in quotes:
            self.news_p.append([i.text, 'https://ria.ru' + i.get('href')])

    def pars_news(self, link_):    
        textarea = ''
        response = requests.get(link_)
        soup = BeautifulSoup(response.text, 'lxml')
        quotes = soup.find_all('div', class_="article__text")
        for i in quotes:
            textarea += i.text

        textarea = textarea.split('.')
        for rep in textarea:
            if rep:
                self.textBrowser.append(f'{self.nam_b}\n{rep}\n')
                self.say_message(rep) 
    
    def plug(self, replic):

        if self.similarity(data['date'], replic):
            date = str(datetime.now())
            date = date.split()
            day, time = date[0].split('-'), date[1].split(':')
            return self.konvert_date(day, time)

        elif self.similarity(data['web_serf'], replic):
            return self.get_sait()

        elif self.similarity(data['rate'], replic):
            return self.get_rate()

        elif self.similarity(data['func'], replic):
            pass

        else:
            return choice(data['plug'])

    def clasific_LR(self, replic):
        replic = replic.lower() # Убираем заглавные буквы

        class_r = self.model.predict(self.vect.transform([replic]))[0]
        
        # Здесь мы определяем есть ли совпадения между речью человека и нашим датасетом
        maxi = 0

        for mx in self.model.predict_proba(self.vect.transform([replic]))[0]:
            if maxi < mx:
                maxi = mx

        if maxi < 0.1:
            return self.plug(replic)
        
        if class_r == 'greetings.bye':
            self.exit_program()

        return choice(bot[class_r])

    def listen_command(self):
        # Обработка аудио с микрофона
        # obtain audio from the microphone
        r = sr.Recognizer()
        with sr.Microphone() as source:
            print("Скажите вашу команду: ")
            audio = r.listen(source)

        # Обработка речи используя Google Speech Recognition
        # recognize speech using Google Speech Recognition
        try:
            our_speech = r.recognize_google(audio, language="ru")
            print("Вы сказали: " + our_speech)
            return our_speech

        except sr.UnknownValueError:
            return 'Error'

        except sr.RequestError:
            return 'Error'

    def say_message(self, message):
        voice = gTTS(message, lang="ru")
        file_voice_name = "audio_.mp3"
        voice.save(file_voice_name)
        playsound.playsound(file_voice_name)
        os.remove(file_voice_name)
        print("Голосовой ассистент: " + message)


    def bot_ans(self, rep):
        count = 1

        if self.similarity(data['news'], rep):
            self.textBrowser.append(f'{self.nam_b}\n')
            self.get_news()
            for i, j in self.news_p:
                self.textBrowser.append(f'{count}) {i}')
                count += 1
            self.bool_news = True
        else:
            rep = self.clasific_LR(rep)
            self.textBrowser.append(f'{self.nam_b}\n{rep}\n')
            self.say_message(rep)

    def sub(self):
        nam = self.linename.text()
        if self.bool_news:
            num_articl = self.lineEdit.text()
            if num_articl == 'выход':
                self.bool_news = False
            elif self.bool_news:
                num_articl = int(num_articl) - 1
                self.pars_news(self.news_p[num_articl][1])
                self.bool_news = False
        else:
            rep = self.lineEdit.text()
            if nam and rep:
                self.textBrowser.append(f'{nam}\n{rep}\n')
                self.lineEdit.clear()
                self.bot_ans(rep)


if __name__ == "__main__":
    import sys
    app = QtWidgets.QApplication(sys.argv)
    MainWindow = QtWidgets.QMainWindow()
    ui = Ui_MainWindow()
    ui.setupUi(MainWindow)
    MainWindow.show()
    sys.exit(app.exec_())
